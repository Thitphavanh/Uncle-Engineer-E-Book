{% extends "base.html" %}

{% block title %}Uncle Ebook - หนังสืออีบุ๊ค{% endblock %}

{% block content %}
<div class="container mx-auto px-4 lg:px-8 py-8">


    <!-- Filters Section -->
    <div class="mb-6">
        <div class="grid gap-6">

            <!-- Category Filter -->
            <div>
                <div class="flex flex-wrap gap-2">
                    <a href="{% url 'ebooks' %}{% if search_query %}?search={{ search_query }}{% endif %}"
                       class="category-filter-btn {% if not selected_category %}active{% endif %}">
                        <i class="fas fa-th mr-1"></i>ทั้งหมด
                    </a>
                    {% for category in categories %}
                    <a href="{% url 'ebooks' %}?category={{ category.slug }}{% if search_query %}&search={{ search_query }}{% endif %}"
                       class="category-filter-btn {% if selected_category and selected_category.slug == category.slug %}active{% endif %}">
                        <i class="fas fa-book mr-1"></i>{{ category.name }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Active Filters -->
        {% if selected_category or search_query %}
        <div class="mt-4 pt-4 border-t border-gray-200">
            <div class="flex items-center gap-2 flex-wrap">
                <span class="text-sm font-medium">ตัวกรองแสดงผล:</span>
                {% if selected_category %}
                <a href="{% url 'ebooks' %}{% if search_query %}?search={{ search_query }}{% endif %}"
                   class="inline-flex items-center bg-black text-white px-4 py-2 rounded-full text-sm hover:bg-gray-800 transition">
                    {{ selected_category.name }}
                    <i class="fas fa-times ml-2"></i>
                </a>
                {% endif %}
                {% if search_query %}
                <a href="{% url 'ebooks' %}{% if selected_category %}?category={{ selected_category.slug }}{% endif %}"
                   class="inline-flex items-center bg-black text-white px-4 py-2 rounded-full text-sm hover:bg-gray-800 transition">
                    "{{ search_query }}"
                    <i class="fas fa-times ml-2"></i>
                </a>
                {% endif %}
                <a href="{% url 'ebooks' %}" class="text-sm text-gray-600 hover:text-black transition">
                    ล้างตัวกรอง
                </a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Books Grid -->
    {% if all_ebooks %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {% for ebook in all_ebooks %}
        <div class="book-card bg-white rounded-2xl overflow-hidden cursor-pointer group transition-all hover:shadow-2xl">
            <!-- Book Cover -->
            <div class="bg-gray-200 relative overflow-hidden">
                {% if ebook.cover_image %}
                <img src="{{ ebook.cover_image.url }}"
                     alt="{{ ebook.title }}"
                     class="w-full h-94 object-cover group-hover:scale-110 transition-transform duration-500"
                     onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200\'><i class=\'fas fa-book text-6xl text-gray-400\'></i></div>';">
                {% else %}
                <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                    <i class="fas fa-book text-6xl text-gray-400"></i>
                </div>
                {% endif %}

                <!-- Category Badge -->
                {% if ebook.category %}
                <div class="absolute top-3 left-3 bg-black text-white text-xs font-bold px-3 py-1 rounded-full">
                    {{ ebook.category.name }}
                </div>
                {% endif %}

                <!-- Availability Badge -->
                {% if ebook.is_available %}
                <div class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                    พร้อมอ่าน
                </div>
                {% endif %}

                <!-- Hover Overlay -->
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                    <a href="{% url 'ebook_detail' ebook.slug %}" class="bg-white text-black px-6 py-3 rounded-full font-semibold transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                        <i class="fas fa-eye mr-2"></i>ดูรายละเอียด
                    </a>
                </div>
            </div>

            <!-- Book Info -->
            <div class="p-4">
                <h3 class="font-bold text-base mb-2 line-clamp-2 group-hover:text-gray-600 transition min-h-[3rem]">
                    {{ ebook.title }}
                </h3>

                {% if ebook.descriptions %}
                <p class="text-sm text-gray-600 mb-3 line-clamp-2">
                    {{ ebook.descriptions|truncatewords:10 }}
                </p>
                {% endif %}

                <div class="flex items-center justify-between mt-auto">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-book-open text-gray-400 text-sm"></i>
                        <span class="text-sm text-gray-600">{{ ebook.category.name|default:"หนังสือทั่วไป" }}</span>
                    </div>
                </div>

                <!-- Additional Images Indicator -->
                {% if ebook.covers_images.count > 0 %}
                <div class="mt-3 flex items-center text-xs text-gray-500">
                    <i class="fas fa-images mr-1"></i>
                    <span>+{{ ebook.covers_images.count }} รูปภาพ</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- No Books Found -->
    <div class="text-center py-20">
        <div class="inline-flex items-center justify-center w-24 h-24 bg-gray-100 rounded-full mb-6">
            <i class="fas fa-book-open text-4xl text-gray-400"></i>
        </div>
        <h3 class="text-2xl font-bold mb-2">D!H+1*7-</h3>
        <p class="text-gray-600 mb-6">
            {% if search_query %}
            D!H+1*7-5H#13I+2 "{{ search_query }}"
            {% elif selected_category %}
            "1D!H!5+1*7-C+!'+!9H "{{ selected_category.name }}"
            {% else %}
            05I"1D!H!5+1*7-C#0
            {% endif %}
        </p>
        <div class="flex justify-center gap-4">
            {% if search_query or selected_category %}
            <a href="{% url 'ebooks' %}" class="inline-flex items-center bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-gray-800 transition">
                <i class="fas fa-redo mr-2"></i>
                9+1*7-1I+!
            </a>
            {% endif %}
            <a href="{% url 'categories' %}" class="inline-flex items-center bg-gray-100 text-black px-8 py-3 rounded-full font-semibold hover:bg-gray-200 transition">
                <i class="fas fa-th mr-2"></i>
                ย้อนกลับไปดูหมวดหมู่
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Back to Home -->
    <div class="text-center mt-12">
        <a href="{% url 'index' %}" class="inline-flex items-center justify-center px-8 py-3 bg-gray-100 text-black rounded-full hover:bg-gray-200 transition-all duration-300">
            <i class="fas fa-home mr-2"></i>
            ย้อนกลับ
        </a>
    </div>
</div>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .book-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .book-card:hover {
        transform: translateY(-8px);
    }

    .category-filter-btn {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s;
        background: white;
        color: #374151;
    }

    .category-filter-btn:hover {
        border-color: #000;
        transform: scale(1.05);
    }

    .category-filter-btn.active {
        background: #000;
        color: white;
        border-color: #000;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .book-card {
        animation: fadeIn 0.5s ease-out;
    }

    /* Stagger animation for cards */
    .book-card:nth-child(1) { animation-delay: 0.05s; }
    .book-card:nth-child(2) { animation-delay: 0.1s; }
    .book-card:nth-child(3) { animation-delay: 0.15s; }
    .book-card:nth-child(4) { animation-delay: 0.2s; }
    .book-card:nth-child(5) { animation-delay: 0.25s; }
    .book-card:nth-child(6) { animation-delay: 0.3s; }
    .book-card:nth-child(7) { animation-delay: 0.35s; }
    .book-card:nth-child(8) { animation-delay: 0.4s; }
    .book-card:nth-child(9) { animation-delay: 0.45s; }
    .book-card:nth-child(10) { animation-delay: 0.5s; }
</style>

{% block extra_js %}
<script>
    // Auto-submit search form on Enter
    document.querySelector('input[name="search"]').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            this.form.submit();
        }
    });

    // Smooth scroll animation observer
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    document.querySelectorAll('.book-card').forEach(card => {
        observer.observe(card);
    });
</script>
{% endblock %}
{% endblock %}
